<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OrderStatusAI</title>
  <style>
    :root{
      --radius:18px; --pad:14px; --gap:12px; --font:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --text:#0b1020; --muted:#3b4353; --panel:rgba(255,255,255,.45); --panel-border:rgba(255,255,255,.35);
      --btn:#111827; --btn-hover:#0b1220; --user:#111827; --user-text:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:15px/1.55 var(--font);color:var(--text);overflow:hidden}


    .bg{position:fixed;inset:0;z-index:-1;overflow:hidden;background:#eaf0ff}
    .blob{position:absolute;filter:blur(70px);opacity:.75;mix-blend:multiply;border-radius:50%}
    .b1{width:55vw;height:55vw;left:-10vw;top:-10vh;background:#ff7c6e;animation:float1 16s ease-in-out infinite}
    .b2{width:60vw;height:60vw;right:-10vw;top:10vh;background:#7aa8ff;animation:float2 18s ease-in-out infinite}
    .b3{width:45vw;height:45vw;left:30vw;bottom:-15vh;background:#ffd66e;animation:float3 20s ease-in-out infinite}
    .b4 {width: 40vw;height: 40vw;right: 20vw;bottom: -10vh;background: #ff7c2e;animation: float4 22s ease-in-out infinite;}
    @keyframes float1{0%,100%{transform:translate(0,0)}50%{transform:translate(6vw,4vh)}}
    @keyframes float2{0%,100%{transform:translate(0,0)}50%{transform:translate(-5vw,3vh)}}
    @keyframes float3{0%,100%{transform:translate(0,0)}50%{transform:translate(3vw,-4vh)}}
    @keyframes float4{0%,100%{transform:translate(0,0)}50%{transform:translate(-4vw,-3vh)}}


    .wrap{max-width:980px;margin:24px auto;height:calc(100% - 48px);padding:0 16px;display:flex;flex-direction:column;gap:12px}
    header{backdrop-filter:saturate(160%) blur(10px);background:var(--panel);border:1px solid var(--panel-border);box-shadow:0 10px 30px rgba(0,0,0,.08);
      padding:12px 16px;border-radius:20px;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:800;letter-spacing:.2px}
    .brand small{display:block;color:var(--muted);font-weight:500}

    .chat{flex:1;min-height:0;overflow:auto;display:flex;flex-direction:column;gap:10px;
      padding:16px;backdrop-filter:saturate(160%) blur(10px);background:var(--panel);border:1px solid var(--panel-border);
      border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.10)}

    .msg{max-width:78%;padding:12px 14px;border-radius:16px;white-space:pre-wrap;animation:fadeUp .25s ease}
    .msg.bot{align-self:flex-start;background:rgba(255,255,255,.65);border:1px solid var(--panel-border)}
    .msg.user{align-self:flex-end;background:var(--user);color:var(--user-text)}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    .composer{display:flex;gap:10px}
    .composer input{flex:1;padding:12px 14px;border-radius:14px;border:1px solid var(--panel-border);
      background:rgba(255,255,255,.65);backdrop-filter:saturate(160%) blur(8px);}
    .composer button{padding:12px 18px;border-radius:14px;border:0;background:var(--btn);color:#fff;font-weight:600;cursor:pointer}
    .composer button:hover{background:var(--btn-hover)}

    .tip{color:var(--muted)}


    .typing {
      display: inline-flex;
      gap: 4px;
      align-items: center;
      padding: 8px 10px;
    }
    .typing span {
      display: block;
      width: 6px;
      height: 6px;
      background: var(--muted);
      border-radius: 50%;
      animation: blink 1s infinite ease-in-out;
    }
    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="bg">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="blob b4"></div>
  </div>

  <div class="wrap">
    <header>
      <div class="brand">OrderStatusAI<small>Track orders with natural language</small></div>
      <div class="actions"></div>
    </header>

    <main class="chat" id="chat">
      <div class="msg bot">Hi! Please provide your order number and e-mail, and I’ll check its status. </div>
    </main>

    <div class="composer">
      <input id="input" type="text" placeholder="Type your message…" autocomplete="off" />
      <button id="send">Send</button>
    </div>
    <div class="tip">Your message is processed securely. We only use your email to verify your order.</div>
  </div>

  <script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const send  = document.getElementById('send');


  let lastOrderId = "";
  let lastEmail   = "";

  const reId = /\b(\d{3,})\b/;
  const reEmail = /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/;

  function add(who, text){
    const d = document.createElement('div');
    d.className = `msg ${who}`;
    d.textContent = text;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
    return d;
  }
  function addTyping(){
    const d = document.createElement('div');
    d.className = 'msg bot';
    const bubble = document.createElement('div');
    bubble.className = 'typing';
    bubble.innerHTML = '<span></span><span></span><span></span>';
    d.appendChild(bubble);
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
    return d;
  }

  function harvestEntities(text){

    const idm = text.match(reId);
    if (idm) lastOrderId = idm[1];
    const em = text.match(reEmail);
    if (em) lastEmail = em[0].trim();
  }

  async function ask(q){

    harvestEntities(q);

    const t = addTyping();
    try{
      const res = await fetch('/ask',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          question: q,
          order_id: lastOrderId || null,
          email: lastEmail   || null
        })
      });
      const data = await res.json();
      t.remove();

      if(data.error){
        add('bot','Error: ' + data.error);
      }else{
        add('bot', data.reply);


        if (data.order_id) lastOrderId = String(data.order_id);
        if (data.email) lastEmail   = String(data.email);
      }
    }catch(e){
      t.remove();
      add('bot','Network error. Please try again.');
    }
  }

  send.addEventListener('click', ()=>{
    const q = input.value.trim();
    if(!q) return;
    add('user', q);
    input.value = '';
    ask(q);
  });
  input.addEventListener('keydown', e=>{
    if(e.key==='Enter' && !e.shiftKey){
      e.preventDefault();
      send.click();
    }
  });
</script>

</body>
</html>
